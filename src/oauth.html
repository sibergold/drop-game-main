<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Kick Drop Game - Multi-User Setup</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="description" content="Configure your Kick Drop Game with multi-user OAuth setup" />
		<meta name="theme-color" content="#9146ff" />
		
		<!-- Preload critical resources -->
		<link rel="preload" href="oauth.css" as="style" />
		<link rel="preload" href="oauth.ts" as="script" />
		
		<!-- Favicon -->
		<link rel="icon" href="favicon.gif" />
		
		<!-- Styles -->
		<link rel="stylesheet" href="oauth.css" />
		
		<!-- Critical inline CSS for above-the-fold content -->
		<style>
			/* Critical CSS for initial render */
			body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
			.loading-spinner { display: none; }
		</style>
	</head>
	<body>
		<h1>üéÆ Kick Drop Game - Multi-User Setup</h1>
		<div class="info">
			<h3>üìã Setup Instructions:</h3>
			<div class="step">1. Create a Kick Developer Application at <a href="https://kick.com/developer/applications" target="_blank">kick.com/developer/applications</a></div>
			<div class="step">2. Set redirect URI to: <code id="redirect-uri"></code></div>
			<div class="step">3. Copy your Client ID and paste it below</div>
			<div class="step">4. Configure your overlay settings</div>
			<div class="step">5. Click "Authorize with Kick" to start!</div>
		</div>
		
		<div id="error-message" class="error" style="display: none;"></div>
		
		<form id="setup-form">
			<fieldset>
				<legend>üîë Kick Application Settings</legend>
				<p>
					<label for="client_id">Your Kick Client ID:</label>
					<br />
					<input type="text" id="client_id" placeholder="Enter your Kick Client ID" required />
					<br />
					<small>
						Get this from your Kick Developer Application. Required for OAuth.
					</small>
				</p>
			</fieldset>
			<fieldset>
				<legend>‚öôÔ∏è Game Options</legend>
				<p>
					<label for="gravity">Gravity (downward velocity):</label>
					<br />
					<input type="number" id="gravity" placeholder="400" />
					<br />
					<small>
						The velocity value of downward force on sprite objects.
					</small>
				</p>
				<p>
					<label for="gravity_chute">Gravity with parachute:</label>
					<br />
					<input type="number" id="gravity_chute" placeholder="60" />
					<br />
					<small>
						The gravity applied to sprites once their parachute is open.
					</small>
				</p>
				<p>
					<label for="max_velocity">Maximum velocity</label>
					<br />
					<input type="number" id="max_velocity" placeholder="600" />
					<br />
					<small>
						The upper threshold for a sprite's random initial horizontal
						velocity.
					</small>
				</p>
				<p>
					<label for="wait">Wait:</label>
					<br />
					<input type="number" id="wait" placeholder="60" />
					<br />
					<small>
						The number of seconds to wait (after the last drop has landed)
						before resetting the game.
					</small>
				</p>
			</fieldset>
			<p>
				<button type="button" id="authorize-btn" disabled>üöÄ Authorize with Kick</button>
			</p>
		</form>
		
		<script>
			// Set redirect URI dynamically
			document.getElementById('redirect-uri').textContent = window.location.href;
			
			// Enable authorize button when client ID is entered
			const clientIdInput = document.getElementById('client_id');
			const authorizeBtn = document.getElementById('authorize-btn');
			
			clientIdInput.addEventListener('input', function() {
				authorizeBtn.disabled = !this.value.trim();
			});
			
			// Lazy load OAuth module when user interacts
			let oauthModuleLoaded = false;
			
			function loadOAuthModule() {
				if (!oauthModuleLoaded) {
					oauthModuleLoaded = true;
					import('./oauth.ts').catch(err => {
						console.error('Failed to load OAuth module:', err);
					});
				}
			}
			
			// Load OAuth module on first user interaction
			['click', 'keydown', 'touchstart'].forEach(event => {
				document.addEventListener(event, loadOAuthModule, { once: true, passive: true });
			});
			
			// Also load when client ID input is focused
			clientIdInput.addEventListener('focus', loadOAuthModule, { once: true });
			
			// Performance optimization: Preload on hover
			authorizeBtn.addEventListener('mouseenter', loadOAuthModule, { once: true });
		</script>
	</body>
</html>
