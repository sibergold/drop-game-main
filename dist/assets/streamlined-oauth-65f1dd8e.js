import{C as e,i as a,e as g,f as m,b as p}from"./central-config-5fe99fca.js";const y=Object.fromEntries(window.location.hash.substring(1)?.split("&").map(l=>l.split("="))??[]),w=Object.fromEntries(window.location.search.substring(1)?.split("&").map(l=>l.split("=").map(decodeURIComponent))??[]),i={...y,...w};class h{errorDiv;successDiv;quickAuthorizeBtn;setupSection;resultSection;overlayUrlDiv;copyUrlBtn;openObsBtn;constructor(){console.log("StreamlinedKickOAuth constructor called"),this.errorDiv=document.getElementById("error-message"),this.successDiv=document.getElementById("success-message"),this.quickAuthorizeBtn=document.getElementById("quick-authorize-btn"),this.setupSection=document.getElementById("setup-section"),this.resultSection=document.getElementById("result-section"),this.overlayUrlDiv=document.getElementById("overlay-url"),this.copyUrlBtn=document.getElementById("copy-url-btn"),this.openObsBtn=document.getElementById("open-obs-btn"),console.log("DOM elements found:",{errorDiv:!!this.errorDiv,successDiv:!!this.successDiv,quickAuthorizeBtn:!!this.quickAuthorizeBtn,setupSection:!!this.setupSection,resultSection:!!this.resultSection,overlayUrlDiv:!!this.overlayUrlDiv,copyUrlBtn:!!this.copyUrlBtn,openObsBtn:!!this.openObsBtn}),this.init()}init(){if(console.log("StreamlinedKickOAuth init() called"),console.log("CLIENT_ID:",e.CLIENT_ID),console.log("isCentralConfigValid():",a()),i.code){console.log("OAuth return detected:",{code:i.code,state:i.state}),this.handleOAuthReturn();return}console.log("Setting up event listeners"),this.quickAuthorizeBtn.addEventListener("click",()=>{console.log("Quick authorize button clicked"),this.startStreamlinedOAuth()}),this.copyUrlBtn.addEventListener("click",()=>this.copyOverlayUrl()),this.openObsBtn.addEventListener("click",()=>this.openInOBS()),a()?console.log("Central config is valid, button should be enabled"):(console.log("Central config is invalid"),this.showError(e.UI_CONFIG.messages.error_no_client_id),this.quickAuthorizeBtn.disabled=!0)}async handleOAuthReturn(){try{console.log("ðŸ”„ Handling OAuth return..."),console.log("URL params:",i);const t=sessionStorage.getItem("kick_oauth_state");if(console.log("Stored state:",t),console.log("Received state:",i.state),i.state&&t&&i.state!==t)throw new Error("Invalid state parameter - possible CSRF attack");const o=i.code;if(console.log("Authorization code:",o?"YES":"NO"),!o)throw new Error("No authorization code received");const n=await g(o,window.location.href.split("?")[0]);if(console.log("Access token received:",n?"YES":"NO"),!n)throw new Error("Failed to exchange code for access token");const r=await m(n);if(!r)throw new Error("Failed to get user information");const c=r.username,d=r.chatroom?.id;if(!d)throw new Error(e.UI_CONFIG.messages.error_no_chatroom);const s=this.buildOverlayUrl(n,c,d.toString());this.showSuccess(s),setTimeout(()=>{console.log("ðŸ”„ Cleaning up URL and redirecting...");const u=window.location.href.split("?")[0];window.history.replaceState({},document.title,u)},2e3)}catch(t){console.error("OAuth error:",t),this.showError(`Authorization failed: ${t instanceof Error?t.message:"Unknown error"}`),setTimeout(()=>{console.log("ðŸ”„ Cleaning up URL after error...");const o=window.location.href.split("?")[0];window.history.replaceState({},document.title,o)},3e3)}}buildOverlayUrl(t,o,n){let r=`${window.location.origin}/index.html#access_token=${t}&channel=${o}&chatroomId=${n}`;return["gravity","gravity_chute","max_velocity","wait"].forEach(c=>{const s=document.getElementById(c)?.value;s&&s.trim()&&(r+=`&${c}=${encodeURIComponent(s)}`)}),r}async startStreamlinedOAuth(){if(console.log("startStreamlinedOAuth() called"),!a()){console.log("Central config invalid in startStreamlinedOAuth"),this.showError(e.UI_CONFIG.messages.error_no_client_id);return}try{console.log("Building OAuth URL...");const t=await p(window.location.href.split("?")[0]);console.log("OAuth URL built:",t),this.quickAuthorizeBtn.textContent=e.UI_CONFIG.messages.loading,this.quickAuthorizeBtn.disabled=!0,console.log("Redirecting to OAuth URL..."),window.location.href=t}catch(t){console.error("OAuth start error:",t),this.showError(`Failed to start authorization: ${t instanceof Error?t.message:"Unknown error"}`)}}showSuccess(t){this.setupSection.style.display="none",this.resultSection.style.display="block",this.overlayUrlDiv.textContent=t,this.successDiv.textContent=e.UI_CONFIG.messages.success,this.successDiv.style.display="block",this.errorDiv.style.display="none"}showError(t){this.errorDiv.textContent=t,this.errorDiv.style.display="block",this.successDiv.style.display="none",this.quickAuthorizeBtn.textContent="ðŸš€ Start with Kick Authorization",this.quickAuthorizeBtn.disabled=!a()}async copyOverlayUrl(){try{const t=this.overlayUrlDiv.textContent||"";await navigator.clipboard.writeText(t);const o=this.copyUrlBtn.textContent;this.copyUrlBtn.textContent=e.UI_CONFIG.messages.copied,this.copyUrlBtn.style.background=e.UI_CONFIG.theme.primary_color,setTimeout(()=>{this.copyUrlBtn.textContent=o,this.copyUrlBtn.style.background=""},2e3)}catch(t){console.error("Copy failed:",t),this.showError("Failed to copy URL to clipboard")}}openInOBS(){const t=this.overlayUrlDiv.textContent||"",o=`${e.OBS_CONFIG.deep_link_protocol}addsource/browser_source?url=${encodeURIComponent(t)}&width=${e.OBS_CONFIG.default_width}&height=${e.OBS_CONFIG.default_height}&name=${encodeURIComponent(e.OBS_CONFIG.source_name)}`;try{window.open(o,"_blank"),setTimeout(()=>{alert(`If OBS didn't open automatically:

1. Open OBS Studio
2. Add a new Browser Source
3. Set URL to: ${t}
4. Set Width: 1920, Height: 1080
5. Uncheck "Shutdown source when not visible"`)},1e3)}catch(n){console.error("OBS open failed:",n),alert(`Manual OBS Setup:

1. Open OBS Studio
2. Add a new Browser Source
3. Set URL to: ${t}
4. Set Width: 1920, Height: 1080
5. Uncheck "Shutdown source when not visible"`)}}}console.log("Document ready state:",document.readyState);document.readyState==="loading"?(console.log("Document still loading, waiting for DOMContentLoaded"),document.addEventListener("DOMContentLoaded",()=>{console.log("DOMContentLoaded event fired, initializing StreamlinedKickOAuth"),new h})):(console.log("Document already loaded, initializing StreamlinedKickOAuth immediately"),new h);export{h as StreamlinedKickOAuth};
//# sourceMappingURL=streamlined-oauth-65f1dd8e.js.map
